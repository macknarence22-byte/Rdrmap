<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RP Map Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <!-- MAP -->
  <div id="map-root">
    <img id="map-image" src="/assets/map.jpg" alt="Map" />
  </div>

  <!-- COLLAPSIBLE SIDEBAR -->
  <aside id="sidebar" class="collapsed">
    <header>
      <h1>RP Map</h1>
      <button id="toggleSidebar">â˜°</button>
    </header>

    <section>
      <input id="search" placeholder="Search houses, POIs, roadsâ€¦" />
    </section>

    <section class="editor-only">
      <h3>Editor Tools</h3>
      <button>Add Marker</button>
      <button>Draw Road</button>
      <button>Draw Area</button>
      <button class="danger">Delete Selected</button>
    </section>

    <section>
      <h3>Info</h3>
      <div id="info">Nothing selected</div>
    </section>
  </aside>

  <!-- BOTTOM BAR -->
  <footer id="bottombar">
    <span id="coords">x: â€” y: â€”</span>
    <span id="zoom">zoom: 1.00</span>
  </footer>

  <!-- LOGIN BUTTON -->
  <button id="loginBtn" class="floating">ğŸ” Login</button>

<script>
/* =========================
   AUTH
========================= */
async function checkAuth() {
  const res = await fetch("/api/me");
  if (!res.ok) return null;
  return res.json();
}

function login() {
  window.location.href = "/api/login";
}

function logout() {
  window.location.href = "/api/logout";
}

/* =========================
   UI STATE
========================= */
const sidebar = document.getElementById("sidebar");
document.getElementById("toggleSidebar").onclick = () => {
  sidebar.classList.toggle("collapsed");
};

document.getElementById("loginBtn").onclick = login;

/* =========================
   INIT
========================= */
(async () => {
  const user = await checkAuth();
  if (user?.editor) {
    document.body.classList.add("is-editor");
    document.getElementById("loginBtn").textContent = "ğŸšª Logout";
    document.getElementById("loginBtn").onclick = logout;
  }
})();
</script>
</body>
</html>